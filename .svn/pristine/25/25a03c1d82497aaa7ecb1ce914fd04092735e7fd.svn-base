package enklikanketa.com.a1kapanel.Dialogs;

import android.app.Activity;
import android.os.Bundle;
import android.support.annotation.StyleRes;
import android.support.v7.app.AppCompatDialog;
import android.util.Log;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.TextView;

import org.json.JSONException;
import org.json.JSONObject;

import enklikanketa.com.a1kapanel.Libraries.GeneralLib;
import enklikanketa.com.a1kapanel.R;
import enklikanketa.com.a1kapanel.Tasks.sendNextPinEditTask;

/**
 * Created by Developer on 29.6.2017.
 */

public class DialogUserActivity extends AppCompatDialog {

    private String TAG = "DialogUserActivity";
    private Activity act;
    private int activity_id;

    // This is the reference to the associated listener
    private final TaskListener taskListener;

    public DialogUserActivity(Activity act, @StyleRes int themeResId, int activity_id, TaskListener listener) {
        super(act, themeResId);
        this.act = act;
        this.activity_id = activity_id;
        this.taskListener = listener;
    }

    public interface TaskListener {
        void onFinished(String result);
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        setContentView(R.layout.dialog_user_activity);

        LinearLayout uad_parent = findViewById(R.id.uad_parent);

        String[] actArr = act.getResources().getStringArray(R.array.activity_types);
        String[] actArrValues = act.getResources().getStringArray(R.array.activity_types_values);

        for (int i = 0; i < actArr.length; i++) {
            View optionView = View.inflate(act, R.layout.dialog_user_activity_item, null);
            TextView optionTextView = optionView.findViewById(R.id.textView);
            optionTextView.setText(actArr[i]);

            optionView.setOnClickListener(new customOnClickListener(actArrValues[i]));

            if (uad_parent != null)
                uad_parent.addView(optionView);
        }
    }

    private class customOnClickListener implements View.OnClickListener {

        String var;

        private customOnClickListener(String var) {
            this.var = var;
        }

        @Override
        public void onClick(View v) {
            // poslji
            JSONObject object = new JSONObject();

            try {
                JSONObject sensorActivity = new JSONObject();
                sensorActivity.put(var, 100);

                object.put("sensor_activity_all", sensorActivity);
                object.put("activity_id", activity_id);

            } catch (JSONException e) {
                //Log.e(TAG, "Could not parse malformed JSON: \"" + object.toString() + "\"");
                GeneralLib.reportCrash(e, object.toString());
            }
            Log.d(TAG, "activity_id : " + activity_id);
            new sendNextPinEditTask(act, activity_id, object, "editGeoActivity",
                    new sendNextPinEditTask.TaskListener() {
                        @Override
                        public void onFinished(String result) {
                            if (taskListener != null)
                                taskListener.onFinished(result);
                        }
                    }).execute();
            DialogUserActivity.this.dismiss();
        }
    }
}

