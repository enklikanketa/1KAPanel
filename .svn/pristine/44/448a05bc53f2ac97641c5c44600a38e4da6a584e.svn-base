/*
 * Made by:
 * Uroš Podkrižnik
 * uros.podkriznik(at)gmail.com
 * Tel.: 041829380
 */

package enklikanketa.com.a1kapanel;

import android.content.Intent;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;

import enklikanketa.com.a1kapanel.System.Database;
import enklikanketa.com.a1kapanel.System.Network;


public class vpis extends AppCompatActivity {

    private String TAG = "vpis";
    EditText upoIme;
    Database DB;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.vpis);

        //prikazi ikono v actionbar
        /*ActionBar actionBar = getSupportActionBar();
        if (actionBar != null) {
            actionBar.setDisplayOptions(ActionBar.DISPLAY_SHOW_HOME | ActionBar.DISPLAY_SHOW_TITLE);
            actionBar.setIcon(R.drawable.ic_action);
        }*/

        DB = new Database(this);

        upoIme = findViewById(R.id.upoIme);
        Button buttonVpis = findViewById(R.id.buttonVpis);
        buttonVpis.setOnClickListener(buttonVpisClick);
        /*Button buttonNewIdentifier = findViewById(R.id.buttonNoIdentifier);
        buttonNewIdentifier.setOnClickListener(buttonNewIdentifierClick);*/

        //pobere podatke o uporabniku iz baze
        String[] uporabnik = DB.getRowData("uporabnik",
                new String[]{"identifier"}, null);

        //ce je uporabnik ze v bazi, ga vpisi v okno
        if (uporabnik != null)
            upoIme.setText(uporabnik[0]);
    }

    //gumb za vpis
    OnClickListener buttonVpisClick = new OnClickListener() {
        public void onClick(View v) {
            shraniUporabnika(upoIme.getText().toString());
        }
    };

    //gumb za vpis
    OnClickListener buttonNewIdentifierClick = new OnClickListener() {
        public void onClick(View v) {
            shraniUporabnika("no_identifier");
        }
    };

    /**
     * Save user in user table, delete old data and go to Main.class
     *
     * @param identifier - identifier of user
     */
    private void shraniUporabnika(String identifier) {

        //ce tabela uporabniki ni prazna, jo pobrise
        if (DB.stejData("uporabnik", null) != 0) {
            DB.deleteAllRows("uporabnik");
        }

        //vstavi v tabelo novega uporabnika
        DB.insertData("uporabnik", new String[][]{
                {"identifier", identifier},
                {"id_server", ""}});

        Intent myIntent = new Intent(vpis.this, Main.class);
        if (Network.checkMobileInternet(vpis.this, true)) {
            startActivity(myIntent);
            finish();
        }
    }

    //gumb nazaj na telefonu
    /*public void onBackPressed() {
        generalLib.exitDialog(this);
    }//konec onBackPressed()
*/
}
