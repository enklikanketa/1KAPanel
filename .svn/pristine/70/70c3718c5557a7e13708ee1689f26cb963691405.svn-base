package enklikanketa.com.a1kapanel.Receivers;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;

import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;

import enklikanketa.com.a1kapanel.Libraries.NotificationLib;

/**
 * Created by podkrizniku on 27/11/2017.
 */

public class AlarmReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Log.d("1kapanel", "wewe AlarmReceiver onReceive");

        if (isInHourRange(900, 2100)) {
            //checkes whether the current time is between 14:49:00 and 20:11:13.
            //Log.d("1kapanel", "wewe in range");

            Bundle bundle = intent.getExtras();
            HashMap<String, String> data = new HashMap<>();
            if(bundle != null) {
                data.put("link", bundle.getString("link"));
                data.put("title", bundle.getString("title"));
                data.put("message", bundle.getString("message"));
                data.put("sound", bundle.getString("sound"));
                data.put("sender_id", bundle.getString("sender_id"));
            }
            NotificationLib.showNotificationSurvey(context, data);
        }
    }

    /**
     * Check if now is in range in from - to hour (ex. 800 is 8:00; 840 is 8:40)
     * @param from - start time hour*100 + minutes
     * @param to - end time hour*100 + minutes
     * @return true if now is in range, false otherwise
     */
    private boolean isInHourRange(int from, int to){
        Date date = new Date();
        Calendar c = Calendar.getInstance();
        c.setTime(date);
        int t = c.get(Calendar.HOUR_OF_DAY) * 100 + c.get(Calendar.MINUTE);
        return to > from && t >= from && t <= to || to < from && (t >= from || t <= to);
    }
}
