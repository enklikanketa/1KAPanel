package enklikanketa.com.a1kapanel.Libraries;

import android.content.Context;

import enklikanketa.com.a1kapanel.System.Database;
import enklikanketa.com.a1kapanel.Tasks.sendRegistrationIDTask;
import enklikanketa.com.a1kapanel.Tasks.sendTrakingLogTask;

/**
 * Created by podkrizniku on 18/12/2017.
 */

public class DoOnConnection {
    private Context ctx;

    public DoOnConnection(Context base) {
        ctx = base;
        checkThingsToSend();
    }

    private void checkThingsToSend(){
        Database DB = (Database) Database.getInstance(ctx);
        //does data of tracking log exists
        int stej = DB.stejData("things_to_send", "name = 'tracking_log'");
        if(stej > 0) {
            new sendTrakingLogTask(ctx, null).execute();
        }

        //did FCM registrationID changed
        String[] reg_id = DB.getRowData("things_to_send",
                new String[]{"value"}, "name = 'registration_id'");
        if(reg_id != null) {
            new sendRegistrationIDTask(ctx, reg_id[0]).execute();
        }

        //does data of refresh alarms exists
        stej = DB.stejData("things_to_send", "name = 'get_alarms'");
        if(stej > 0) {
            AlarmLib alib = new AlarmLib(ctx);
            alib.refreshAlarms();
        }

        //does data of refresh geofences exists
        stej = DB.stejData("things_to_send", "name = 'get_geofences'");
        if(stej > 0) {
            GeofencingLib glib = new GeofencingLib(ctx);
            glib.refreshGeofences();
        }

        //does data of triggered geofences exists
        /*stej = DB.stejData("things_to_send", "name = 'triggered_geofences'");
        if(stej > 0) {
            new sendTriggeredGeofencesTask(ctx, null).execute();
        }*/
    }
}
