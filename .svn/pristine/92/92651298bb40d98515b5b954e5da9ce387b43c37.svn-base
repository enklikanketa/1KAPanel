package enklikanketa.com.a1kapanel.Libraries;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.support.v4.app.NotificationCompat;

import java.util.Map;

import enklikanketa.com.a1kapanel.R;
import enklikanketa.com.a1kapanel.Receivers.ActionReceiver;
import enklikanketa.com.a1kapanel.WebResevanje;

import static android.content.Context.NOTIFICATION_SERVICE;

/**
 * Created by podkrizniku on 06/12/2017.
 */

public class NotificationLib {

    private Context ctx;

    public NotificationLib(Context base) {
        ctx = base;
    }

    /**
     * Show notification for survey
     * @param data - map of pairs for title, message, link, sound and sender_id
     */
    public void showNotificationSurvey(Map<String, String> data) {
        if(data != null) {
            //you can get your text message here.
            String message = data.get("message");
            String title = data.get("title");
            String link = data.get("link");
            String sound = data.get("sound");
            String sender_id = data.get("sender_id");

            Intent intent = new Intent(ctx, WebResevanje.class);
            intent.putExtra("link", link);

            int id;
            if (sender_id != null)
                id = Integer.parseInt(sender_id);
            else
                id = GeneralLib.getRandomInt();

            PendingIntent pi = PendingIntent.getActivity(ctx, id, intent, PendingIntent.FLAG_UPDATE_CURRENT);

            NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(ctx)
                    .setTicker(ctx.getString(R.string.app_name))
                    .setSmallIcon(android.R.drawable.ic_menu_myplaces)
                    .setContentTitle(title)
                    .setContentText(message)
                    .setContentIntent(pi)
                    //.addAction(action)
                    //.setOngoing(true);//non removable
                    .setAutoCancel(true);//removable on touch action

            if (sound != null && sound.equals("1"))
                notificationBuilder.setDefaults(Notification.DEFAULT_ALL);

            Notification notification = notificationBuilder.build();

            NotificationManager notificationManager = (NotificationManager) ctx.getSystemService(NOTIFICATION_SERVICE);
            if (notificationManager != null)
                notificationManager.notify(id, notification);
        }
    }

    /**
     * Show Ongoing (static) notification about "app is tracking"
     */
    public void showNotificationTracking() {
        //This is the intent of PendingIntent
        Intent intentAction = new Intent(ctx, ActionReceiver.class);
        PendingIntent pi = PendingIntent.getBroadcast(ctx, 0, intentAction, PendingIntent.FLAG_UPDATE_CURRENT);

        NotificationCompat.Action action = new NotificationCompat.Action.Builder(-1, ctx.getString(R.string.Stop_Tracking), pi).build();

        NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(ctx)
                .setTicker(ctx.getString(R.string.app_name))
                .setSmallIcon(android.R.drawable.ic_menu_myplaces)
                .setContentTitle(ctx.getString(R.string.app_tracking))
                //.setContentText(message)
                //.setContentIntent(pi)
                .addAction(action)
                .setOngoing(true);//non removable
        //.setAutoCancel(true);//removable on touch action

        Notification notification = notificationBuilder.build();

        NotificationManager notificationManager = (NotificationManager) ctx.getSystemService(NOTIFICATION_SERVICE);
        if(notificationManager != null)
            notificationManager.notify(ctx.getResources().getInteger(R.integer.tracking_notification_id), notification);
    }

    /**
     * Show notification about "GPS is off"
     */
    public void showNotificationGPS() {
        //This is the intent of PendingIntent
        //Intent intentAction = new Intent(ctx, Main.class);
        //PendingIntent pi = PendingIntent.getBroadcast(ctx, 0, intentAction, PendingIntent.FLAG_UPDATE_CURRENT);

        NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(ctx)
                .setTicker(ctx.getString(R.string.app_name))
                .setSmallIcon(android.R.drawable.ic_menu_myplaces)
                .setContentTitle(ctx.getString(R.string.turn_gps_on));
                //.setContentText(message)
                //.setContentIntent(pi)
                //.setOngoing(true);//non removable
        //.setAutoCancel(true);//removable on touch action

        Notification notification = notificationBuilder.build();

        NotificationManager notificationManager = (NotificationManager) ctx.getSystemService(NOTIFICATION_SERVICE);
        if(notificationManager != null)
            notificationManager.notify(ctx.getResources().getInteger(R.integer.GPS_notification_id), notification);
    }

    public void hideNotification(int notification_id){
        NotificationManager mNotificationManager = (NotificationManager) ctx.getSystemService(Context.NOTIFICATION_SERVICE);
        if (mNotificationManager != null)
            mNotificationManager.cancel(notification_id);
    }
}
