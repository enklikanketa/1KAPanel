package enklikanketa.com.a1kapanel;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

import java.util.Arrays;
import java.util.HashMap;

import enklikanketa.com.a1kapanel.System.Database;

public class MyStartServiceReceiver extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.d("1kapanel", "wewe MyStartServiceReceiver onReceive");
        /*Util.scheduleJob(context);
        Intent intentAction = new Intent(context, ActionReceiver.class);
        context.sendBroadcast(intentAction);*/

        String[][] alarms = Database.getData(new Database(context), "alarms",
                new String[]{"srv_id", "alarm_notif_title", "alarm_notif_message", "alarm_notif_repeat", "alarm_notif_sound", "alarm_id"}, null);

        if(alarms != null)
            for(String[] arr : alarms) {
                Log.d("1kapanel", "wewe alarm" + Arrays.toString(arr));

                String[] survey = Database.getRowData(new Database(context), "surveys",
                        new String[]{"link"}, "id="+arr[0]);
                String link = null;
                if(survey != null)
                    link = survey[0];

                HashMap<String, String> data = new HashMap<>();
                data.put("link", link);
                data.put("title", arr[1]);
                data.put("message", arr[2]);
                data.put("sound", arr[4]);
                data.put("repeat", arr[3]);

                MyFirebaseMessagingService.setAlarm(context, data, Integer.parseInt(arr[5]));
            }

        PreferencesFragment.showNotificationTracking(context, context.getString(R.string.app_tracking));
    }
}