package enklikanketa.com.a1kapanel.Libraries;

import android.content.Context;

import org.json.JSONArray;

import enklikanketa.com.a1kapanel.System.Database;
import enklikanketa.com.a1kapanel.Tasks.sendRegistrationIDTask;
import enklikanketa.com.a1kapanel.Tasks.sendTrakingLogTask;

/**
 * Created by podkrizniku on 18/12/2017.
 */

public class DoOnConnection {
    private Context ctx;

    public DoOnConnection(Context base) {
        ctx = base;
        checkThingsToSend();
    }

    private void checkThingsToSend(){
        Database DB = new Database(ctx);
        //pobere podatke o logih iz baze
        JSONArray old_logs_to_send = DB.getJSONData("things_to_send",
                new String[]{"value", "event", "tsSec"}, "name = 'tracking_log'");
        if(old_logs_to_send != null) {
            new sendTrakingLogTask(ctx, null).execute();
        }

        //pobere podatke o registration id iz baze
        String[] reg_id = DB.getRowData("things_to_send",
                new String[]{"value", "tsSec"}, "name = 'registration_id'");
        if(reg_id != null) {
            new sendRegistrationIDTask(ctx, reg_id[0]).execute();
        }
    }
}
